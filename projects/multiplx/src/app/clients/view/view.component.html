<div class="subheader py-5 py-lg-10 gutter-b subheader-solid" id="kt_subheader"
    style="background-color: #127E9B; background-position: right bottom; background-size: auto 100%; background-repeat: no-repeat; background-image: url(assets/media/svg/patterns/art_barra.svg)">
    <div class="container-fluid d-flex flex-column">

        <!--begin::Title-->
        <div class="d-flex align-items-sm-end flex-column flex-sm-row mb-5">
            <h2 class="d-flex align-items-center text-white mr-5 mb-0">Cliente</h2>
        </div>

        <!--end::Title-->
    </div>
</div>

<!--end::Subheader-->


<app-client-edit [client]="client" [saveEvent]="saveEvent"></app-client-edit>


<!--begin::Modal-->
<div class="modal fade" id="filesModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Arquivos</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="kt_subheader_leaflet" style="width: 100%;">
                    <upload-file [config]="config" #dzoneUpload></upload-file>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" #closeModalFile class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Cancelar</button>
                <button type="button" (click)="onSaveFiles()" class="btn btn-primary font-weight-bold">Salvar</button>
            </div>
        </div>
    </div>
</div>
<!--end::Modal-->


<!--begin::Entry-->
<div class="d-flex flex-column-fluid">
    <!--begin::Container-->
    <div class="container">
        <!--begin::Row-->
        <div class="row">
            <div class="col-md-7">
                <div class="card card-custom gutter-b" style="height: 550px; overflow-y: auto;">
                    <div class="card-header">
                        <h3 class="card-title">
                            Dados Gerais
                            <span class="ml-1">
                                <p class="form-control-plaintext text-muted">
                                    <span *ngIf="client.last_access; else clientLastAccessNever">
                                        <span class="label label-light-info label-pill label-inline mr-2">Último acesso {{ client.last_access | date: "dd/MM/yyyy" }}</span>
                                    </span>
                                    <ng-template #clientLastAccessNever>
                                        <span class="label label-light-warning label-pill label-inline mr-2">Nunca acessou</span>
                                    </ng-template>
                                </p>
                            </span>
                        </h3>

                        <!-- <div class="card-toolbar">
                            <a class="btn btn-light-success font-weight-bolder font-size-sm mr-3" (click)="onResetPassword()">Redefinir Senha</a>
                            <a class="btn btn-primary font-weight-bolder font-size-sm mr-3" data-toggle="modal" data-target="#modalClient">Editar</a>
                        </div> -->
                        <div class="card-toolbar">
                            <a href="javascript:;" class="btn btn-icon btn-sm btn-light-info mr-1" (click)="onResetPassword()" data-card-tool="Redefinir senha" title="Redefinir senha">
                                <i class="fas fa-lock-open"></i>
                            </a>
                            <a [routerLink]="['/clientes/cadastro/' + client.id]" class="btn btn-icon btn-sm btn-light-success mr-1" data-toggle="modal" data-target="#modalClient" data-card-tool="Editar dados" title="Editar dados">
                                <i class="far fa-edit"></i>
                            </a>
                        </div>
                    </div>
                    <form class="form" #form="ngForm">
                        <div class="card-body">
                            <div class="form-group row">
                                <div class="col-lg-4">
                                    <label>Status:</label>
                                    <p class="form-control-plaintext text-muted">
                                        <span *ngIf="client.status == 1; else clientBloqued" class="label label-light-success label-pill label-inline mr-2">
                                            Ativo
                                        </span>

                                        <ng-template #clientBloqued >
                                            <span class="label label-light-danger label-pill label-inline mr-2">
                                                Bloqueado
                                            </span>
                                        </ng-template>
                                    </p>
                                </div>
                                <div class="col-lg-4">
                                    <label>Cliente próprio:</label>
                                    <p class="form-control-plaintext text-muted">
                                        <span *ngIf="client.own_client == 1; else ownClient">
                                            <span class="label label-light-primary label-pill label-inline mr-2">Sim</span>
                                        </span>
                                        <ng-template #ownClient>
                                            <span class="label label-light-primary label-pill label-inline mr-2">Não</span>
                                        </ng-template>
                                    </p>
                                </div>
                                <div class="col-lg-4">
                                    <label>Tutelado/Curatelado /Menor:</label>
                                    <p class="form-control-plaintext text-muted">
                                        <span *ngIf="client.tutelado == 1; else clientTutelado">
                                            <span class="label label-light-primary label-pill label-inline mr-2">Sim</span>
                                        </span>
                                        <ng-template #clientTutelado>
                                            <span class="label label-light-primary label-pill label-inline mr-2">Não</span>
                                        </ng-template>
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Nome completo:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.name }}
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>CPF:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.cpf | mask: "000.000.000-00" }}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Data de nascimento:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.birth_date | date:'dd/MM/yyyy' }}
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>RG:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.rg }} {{ client.rg_emitter }} {{ client.rg_date | date: 'dd/MM/YYYY' }}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Certificado Digital:</label>
                                    <p class="form-control-plaintext text-muted">
                                        <span *ngIf="client.certificado_digital_type != null; else certificadoDigital">
                                            {{ client.certificado_digital_type }}
                                        </span>

                                        <ng-template #certificadoDigital >
                                            <span class="label label-light-danger label-pill label-inline mr-2">
                                                Não possui
                                            </span>
                                        </ng-template>
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>Profissão:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.profession }}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Nome da mãe:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.mother_name }}
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>Nome do pai:</label>
                                    <p *ngIf="client.father_name; else noFatherName" class="form-control-plaintext text-muted">{{ client.father_name }}</p>
                                    <ng-template #noFatherName>
                                        -
                                    </ng-template>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Estado Civil:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ getCivilStatus(this.client.civil_status) }}
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>Dados Bancários:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ getLegBank() }}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-6">
                                    <label>Contatos:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ client.email }}
                                        <span *ngIf="client.phone"><br>{{ client.phone | mask: "(00) 0000-00009" }}</span>
                                    </p>
                                </div>
                                <div class="col-lg-6">
                                    <label>Endereço:</label>
                                    <p class="form-control-plaintext text-muted" [innerHTML]="getAddress()"></p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label>Outorgado com Dados:</label>
                                    <p class="form-control-plaintext text-muted">
                                        {{ getLegCartorio() }}
                                    </p>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label>Observações:</label>
                                    <p *ngIf="client.obs; else noObs" class="form-control-plaintext text-muted" [innerHTML]="client.obs.split('\n').join('<br>')"></p>
                                    <ng-template #noObs>
                                        <span>-</span>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="col-md-5">
                <div class="card card-custom gutter-b" style="height: 550px;">
                    <div class="card-header">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label font-weight-bolder text-dark">Arquivos</span>
                            <span class="text-muted mt-3 font-weight-bold font-size-sm">{{ countFiles }} encontrado(s)</span>
                        </h3>
                        <div class="card-toolbar">
                            <a href="javascript:;" (click)="setParamsClientUpload(client.id)" class="btn btn-icon btn-sm btn-outline-info" data-toggle="modal" aria-haspopup="true" aria-expanded="false" data-target="#filesModal">
                                <span class="svg-icon svg-icon-2x">
                                    <!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\metronic\theme\html\demo1\dist/../src/media/svg/icons\Files\Cloud-upload.svg--><svg
                                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px"
                                        viewBox="0 0 24 24" version="1.1">
                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <polygon points="0 0 24 0 24 24 0 24" />
                                            <path d="M5.74714567,13.0425758 C4.09410362,11.9740356 3,10.1147886 3,8 C3,4.6862915 5.6862915,2 9,2 C11.7957591,2 14.1449096,3.91215918 14.8109738,6.5 L17.25,6.5 C19.3210678,6.5 21,8.17893219 21,10.25 C21,12.3210678 19.3210678,14 17.25,14 L8.25,14 C7.28817895,14 6.41093178,13.6378962 5.74714567,13.0425758 Z" fill="#000000" opacity="0.3" />
                                            <path d="M11.1288761,15.7336977 L11.1288761,17.6901712 L9.12120481,17.6901712 C8.84506244,17.6901712 8.62120481,17.9140288 8.62120481,18.1901712 L8.62120481,19.2134699 C8.62120481,19.4896123 8.84506244,19.7134699 9.12120481,19.7134699 L11.1288761,19.7134699 L11.1288761,21.6699434 C11.1288761,21.9460858 11.3527337,22.1699434 11.6288761,22.1699434 C11.7471877,22.1699434 11.8616664,22.1279896 11.951961,22.0515402 L15.4576222,19.0834174 C15.6683723,18.9049825 15.6945689,18.5894857 15.5161341,18.3787356 C15.4982803,18.3576485 15.4787093,18.3380775 15.4576222,18.3202237 L11.951961,15.3521009 C11.7412109,15.173666 11.4257142,15.1998627 11.2472793,15.4106128 C11.1708299,15.5009075 11.1288761,15.6153861 11.1288761,15.7336977 Z" fill="#000000" fill-rule="nonzero" transform="translate(11.959697, 18.661508) rotate(-90.000000) translate(-11.959697, -18.661508) " />
                                        </g>
                                    </svg>
                                    <!--end::Svg Icon-->
                                </span>
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <app-client-file-list [filesClient]="filesClient" [deleteFileEvent]="deleteFileEvent"></app-client-file-list>
                    </div>
                </div>

            </div>
            <div class="col-md-12">
                <div class="card card-custom gutter-b">
                    <div class="card-header">
                        <h3 class="card-title align-items-start flex-column">
                            <span class="card-label font-weight-bolder text-dark">Processos</span>
                            <span class="text-muted mt-3 font-weight-bold font-size-sm">{{ countProcess }} encontrado(s)</span>
                        </h3>
                        <div class="card-toolbar">
                            <a class="btn btn-primary font-weight-bolder font-size-sm mr-3">Novo</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div *ngIf="countProcess == 0" class="ml-2">
                            <p class="text-muted">Este cliente não possui nenhum processo...</p>
                        </div>

                        <div *ngIf="countProcess > 0" class="table-wrapper-scroll-y my-custom-scrollbar table-responsive">
                            <table class="table table-head-custom table-head-bg table-borderless table-vertical-center table-hover">
                                <thead>
                                    <tr class="text-left text-uppercase">
                                        <th style="min-width: 15%" class="pl-7 text-center">
                                            <span class="text-dark-75">Data</span>
                                        </th>
                                        <th style="min-width: 15%" class="text-center">Tipo</th>
                                        <th style="min-width: 15%">Valor total</th>
                                        <th style="min-width: 25%" class="text-center">Status</th>
                                        <th style="min-width: 15%">Responsável</th>
                                        <th style="min-width: 15%" class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let pro of process">
                                        <td class="pl-0 py-4 text-center">
                                            <p class="text-dark-75 font-weight-bolder mb-1 font-size-lg" style="margin-left: 21px;">{{ pro.date | date: 'dd/MM/yyyy'}}</p>
                                        </td>
                                        <td class="text-center">
                                            <span class="text-muted font-weight-bold">
                                                <span *ngIf="pro.assignees.length >= 1" class="label label-light-info label-pill label-inline mr-2">
                                                    Cedente
                                                </span>

                                                <span *ngIf="pro.assignors.length >= 1" class="label label-light-info label-pill label-inline">
                                                    Cessionário
                                                </span>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="text-muted font-weight-bold">R$ {{ pro.total_value }}</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="font-weight-bold">
                                                <span class="label label-pill label-inline mr-2" [ngClass]="{'label-light-success': pro.general_status == 1, 'label-light-danger': pro.general_status == 0}">
                                                    {{ pro.status[pro.status.length-1].name ? pro.status[pro.status.length-1].name : pro.status == 1 ? 'Ativo' : 'Encerrado' }}
                                                </span>

                                                <p *ngIf="pro.status[pro.status.length-1].pivot.description" class="text-dark-50">
                                                    <small>
                                                    {{ pro.status[pro.status.length-1].pivot.description }}
                                                    </small>
                                                </p>
                                            </span>
                                        </td>
                                        <td>
                                            {{ pro.responsable.name }}
                                        </td>
                                        <td class="pr-0 text-center">
                                            <a [routerLink]="['/processos/editar/' + pro.id]" class="btn btn-icon btn-sm btn-outline-primary mr-2">
                                                <span class="svg-icon svg-icon-primary svg-icon-2x"><!--begin::Svg Icon | path:C:\wamp64\www\keenthemes\themes\metronic\theme\html\demo1\dist/../src/media/svg/icons\General\Search.svg--> <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24"/>
                                                        <path d="M14.2928932,16.7071068 C13.9023689,16.3165825 13.9023689,15.6834175 14.2928932,15.2928932 C14.6834175,14.9023689 15.3165825,14.9023689 15.7071068,15.2928932 L19.7071068,19.2928932 C20.0976311,19.6834175 20.0976311,20.3165825 19.7071068,20.7071068 C19.3165825,21.0976311 18.6834175,21.0976311 18.2928932,20.7071068 L14.2928932,16.7071068 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                        <path d="M11,16 C13.7614237,16 16,13.7614237 16,11 C16,8.23857625 13.7614237,6 11,6 C8.23857625,6 6,8.23857625 6,11 C6,13.7614237 8.23857625,16 11,16 Z M11,18 C7.13400675,18 4,14.8659932 4,11 C4,7.13400675 7.13400675,4 11,4 C14.8659932,4 18,7.13400675 18,11 C18,14.8659932 14.8659932,18 11,18 Z" fill="#000000" fill-rule="nonzero"/>
                                                    </g>
                                                </svg><!--end::Svg Icon--></span>
                                             </a>
                                            <div class="btn-group" role="group">
                                                <a id="btnGroupDrop1" class="btn btn-icon btn-sm btn-outline-success mr-2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <span class="svg-icon svg-icon-success svg-icon-2x">
                                                        <svg
                                                            xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px"
                                                            viewBox="0 0 24 24" version="1.1">
                                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                <polygon points="0 0 24 0 24 24 0 24" />
                                                                <path
                                                                    d="M5.85714286,2 L13.7364114,2 C14.0910962,2 14.4343066,2.12568431 14.7051108,2.35473959 L19.4686994,6.3839416 C19.8056532,6.66894833 20,7.08787823 20,7.52920201 L20,20.0833333 C20,21.8738751 19.9795521,22 18.1428571,22 L5.85714286,22 C4.02044787,22 4,21.8738751 4,20.0833333 L4,3.91666667 C4,2.12612489 4.02044787,2 5.85714286,2 Z"
                                                                    fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                                <rect fill="#000000" x="6" y="11" width="9" height="2" rx="1" />
                                                                <rect fill="#000000" x="6" y="15" width="5" height="2" rx="1" />
                                                            </g>
                                                        </svg>
                                                    </span>
                                                </a>
                                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                                    <a class="dropdown-item" (click)="generateFormClient(0, pro.id)" *ngIf="pro.assignees.length >= 1" style="cursor: pointer;">Imprimir Ficha Cedente</a>
                                                    <a class="dropdown-item" (click)="generateFormClient(1, pro.id)" *ngIf="pro.assignors.length >= 1" style="cursor: pointer;">Imprimir Ficha Cessionário</a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--end::Row-->
    </div>
    <!--end::Container-->
</div>
<!--end::Entry-->
